# 总体结构
整个挑战赛软件主要分为四个部分：

+ 自动瞄准系统
+ 移动系统
+ 哨岗系统
+ 决策系统

## 自动瞄准系统（已完成）
由于对抗赛的场地相对来说比较小，而且机器人不能进行陀螺动作规避子弹，所以对抗赛的自动瞄准系统在挑战赛上将非常精准。

目前已经将代码移植到ROS系统上运行，并且经过测试，运行时间与移植前并无差距，完全具有实战能力。

## 移动系统
由于挑战赛的场地已知，所以可以采取预置地图的办法，免去了场上建图的麻烦。由于地图的ymal文件可以自行配置，通过高分辨率描述可画出精确的地图以供定位。

ROS中定位主要采用的是navigation包中的amcl节点，这个节点的配置并不困难，目前已经配置完成。不过，这个节点依赖于精确的里程计数据，但目前我们电控得到的角度数据并不精准，需要提升。

而且，定位上也是有可以优化的部分。激光雷达扫描到的点云数据在机器人运动的时候是有畸变的，不过相对来说造成的误差比较小，所以今年比赛不准备对其进行畸变矫正。不过如果研究生同志有兴趣研究、部署畸变矫正相关方案，我们非常欢迎。

至于路径寻找以及速度规划，虽然ROS提供了相关包供调用，但是从上一届的测试视频不难看出效果并不佳。主要问题在于拐点太多，速度规划不佳，没有发挥出麦轮车的优势。通过观看上赛季八强学校的技术答辩，不难发现强队这一方面的代码基本上都是自己写的。所以我们也应当自己写，这项工作将是最耗时也是难度比较高的一部分。如何将路径、速度进行合理的规划，以尽可能发挥我们机器人的机动性，将是一个长期课题。不光本届，若干届之后或许也可以在其上有所优化。

## 哨岗系统

### 基本功能
哨岗的基本功能就是通过神经网络识别，**提供敌方车的位置坐标**。同时在必要的时候为本方车提供**位置校正**。

不过无论哪种方案，可以确定的是上面必然需要部署一个经过TensorRt加速的yolo进行物体识别。这就是这一项目前需要做的事。

哨岗和车之间的通讯使用TCP协议进行通讯，比较稳定，并且目前已经实现。

## 决策系统
目前我对于决策系统没有成熟的想法。原本有想过使用强化学习的方法训练智能体进行对抗，但是实战中参数实在是太多，我个人认为强化学习模型不一定能够训练成功。通过阅读去年的技术方案，发现使用kears提供的决策树训练函数可以训练出模型，但是由于上一届未留下相关测试记录，这个方法还需要试验。最差的情况就是通过**预置战术+临时决策**的方法。如果能在制作决策树方面获得教授的相关指导，相信我队必然能设计出实用的决策树出来。

## 对于新赛季规则变化的讨论
1. 新赛季启动区的障碍块变为所谓“四面透明材质、顶部木质材质”，目前不知道激光雷达能否探测到这些障碍块。
2. 新赛季地面上具有所谓“透明反光材质”的地板，虽然暂且不知道该材质具体摩擦因数是多少，但是我个人认为轮子在上面必然会打滑，从而对里程计数据产生影响，进而影响到定位的精度。而且地面上的这个类似于“冰面”的东西也必然会对视觉识别产生一些影响。
3. 新赛季的“潜伏”机制其实就是对己方定位精度提出一定要求，因为虽然灯条颜色变化，但是本方车辆直接和哨岗通信，只要本方车辆定位准确，灯条颜色变化影响不大。
4. 新赛季同样对哨岗定位精度提出了极高的要求。因为在有“透明反光材质”的障碍块、“冰面”材质的地板的情况下，己方车辆的定位精度还是比较难以控制的。哨岗的“辅助定位”功能的意义被大大放大。我们在训练哨岗神经网络识别模型的时候，务必要注意IOU数值要尽可能的小。
5. 关于“暴击”机制的思考：想要实现“暴击”，就需要同时跟踪1、2号两块装甲板，并且具有数字识别功能。然后令车辆站在两个装甲板位置的平分线上面即可方便的打出“暴击”。
6. 如果激光雷达定位效果实测不佳的话，必须采用工业相机去识别场上的视觉标签进行定位。

### 新赛季变化的总结
目前两个所谓透明反光材质的具体物理性质还没有公布，不过可以确定的是，在定位方面，哨岗和机器人的定位应该是**相辅相成**，**不分主次**的，哨岗不会再像以前一样作为辅助定位的兵种了。而且有可能要上视觉标签识别定位。简而言之，不能只靠激光雷达的定位数据了，强调多兵种、多数据融合定位。

## 目前遇到的问题
经过反复测试，发现定位包的配置是没有问题的，但是我们测试使用的旧的步兵车不能平移、旋转，一但平移、旋转PoseArray就会十分发散，而这两个动作在定位时是十分重要的，所以根本没有办法测试定位的精度，非常难受。希望官方车到来之后能解决这些问题。

## 总结
目前要做的有：路径寻找与平滑、速度规划、加速后神经网络模型的部署、决策树的设计。